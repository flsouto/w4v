<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Rust WAV Effects (WASM)</title>
</head>
<body>
  <h1>WAV Effects in Rust + WebAssembly</h1>
  <input type="file" id="file" accept=".wav" />
  <button id="reverbBtn">Reverb</button>
  <button id="reverseBtn">Reverse</button>
  <br><br>
  <audio id="player" controls></audio>

  <script type="module">
    import init, { reverb_js, reverse_js } from "./pkg/wasm_example.js";

    await init();

    document.getElementById("reverbBtn").addEventListener("click", async () => {
      const fileInput = document.getElementById("file");
      if (!fileInput.files.length) return alert("Choose a WAV first!");

      const arrayBuffer = await fileInput.files[0].arrayBuffer();
      const uint8Array = new Uint8Array(arrayBuffer);

        try {
          const processed = reverb_js(uint8Array, 400, .5);
          const blob = new Blob([processed], { type: "audio/wav" });
          document.getElementById("player").src = URL.createObjectURL(blob);
        } catch (e) {
          alert("Error: " + e);
        }
    });

    document.getElementById("reverseBtn").addEventListener("click", async () => {
      const fileInput = document.getElementById("file");
      if (!fileInput.files.length) return alert("Choose a WAV first!");

      const arrayBuffer = await fileInput.files[0].arrayBuffer();
      const uint8Array = new Uint8Array(arrayBuffer);

        try {
          const processed = reverse_js(uint8Array);
          const blob = new Blob([processed], { type: "audio/wav" });
          document.getElementById("player").src = URL.createObjectURL(blob);
        } catch (e) {
          alert("Error: " + e);
        }
    });
  </script>
</body>
</html>